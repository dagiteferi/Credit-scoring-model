<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Risk Analysis Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@heroicons/v2.0.18/24/outline/index.js"></script>
</head>
<body>
    <div class="assessment-card">
        <header class="assessment-header">
            <h1>Credit Risk Analyzer</h1>
            <p>AI-powered credit risk assessment platform</p>
        </header>

        <nav class="nav-tabs">
            <button class="nav-button active" id="detailedFormBtn">Technical Analysis</button>
            <button class="nav-button" id="simpleFormBtn">Quick Assessment</button>
        </nav>

        <!-- Detailed Form -->
        <form id="detailedForm" class="assessment-form">
            <div class="form-column">
                <div class="form-group">
                    <label>Transaction Details</label>
                    <input type="number" class="input-field" placeholder="Transaction ID" id="transactionId" required>
                    <input type="number" class="input-field" placeholder="Batch ID" id="batchId" required>
                    <input type="datetime-local" class="input-field" id="transactionStartTime" required>
                </div>

                <div class="form-group">
                    <label>Customer Information</label>
                    <input type="number" class="input-field" placeholder="Account ID" id="accountId" required>
                    <input type="number" class="input-field" placeholder="Customer ID" id="customerId" required>
                </div>
            </div>

            <div class="form-column">
                <div class="form-group">
                    <label>Product Details</label>
                    <input type="number" class="input-field" placeholder="Product ID" id="productId" required>
                    <select class="input-field" id="channelId" required>
                        <option value="2">Online Channel</option>
                        <option value="3">Mobile App</option>
                        <option value="5">POS Terminal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Financial Details</label>
                    <input type="number" step="0.01" class="input-field" placeholder="Amount" id="amount" required>
                    <div class="input-group">
                        <input type="text" class="input-field" value="UGX" id="currencyCode" readonly>
                        <input type="text" class="input-field" value="256" id="countryCode" readonly>
                    </div>
                </div>
            </div>

            <button type="submit" class="primary-button" style="grid-column: span 2;">
                Analyze Risk
                <hero-icon-outline:calculator class="w-5 h-5"></hero-icon-outline:calculator>
            </button>
        </form>

        <!-- Simple Form -->
        <form id="simpleForm" class="assessment-form hidden">
            <div class="form-group">
                <label>Average Transaction Amount</label>
                <input type="number" step="0.01" class="input-field" id="avgTransactionAmount" required>
            </div>
            
            <div class="form-group">
                <label>Last Transaction Date</label>
                <input type="date" class="input-field" id="lastTransactionDate" required>
            </div>

            <button type="submit" class="primary-button" style="grid-column: span 2;">
                Quick Analyze
                <hero-icon-outline:bolt class="w-5 h-5"></hero-icon-outline:bolt>
            </button>
        </form>

        <!-- Results Section -->
        <div id="result" class="results-card hidden">
            <h2 class="assessment-header">Risk Analysis Result</h2>
            <div class="score-display" id="creditScore">-</div>
            <div class="risk-indicator" id="statusIndicator"></div>
            <div class="result-details">
                <p class="risk-status" id="riskStatus"></p>
                <p class="recommendation" id="recommendation"></p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p class="loading-text">Analyzing Transaction Patterns...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.assessment-card').classList.remove('hidden');
        });

        // Tab Switching
        document.getElementById('detailedFormBtn').addEventListener('click', () => {
            document.getElementById('detailedForm').classList.remove('hidden');
            document.getElementById('simpleForm').classList.add('hidden');
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('detailedFormBtn').classList.add('active');
        });

        document.getElementById('simpleFormBtn').addEventListener('click', () => {
            document.getElementById('simpleForm').classList.remove('hidden');
            document.getElementById('detailedForm').classList.add('hidden');
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('simpleFormBtn').classList.add('active');
        });

        // Form Submission
        async function handleSubmit(e) {
            e.preventDefault();
            const form = e.target;
            let formData;

            if(form.id === 'detailedForm') {
                formData = {
                    TransactionId: parseInt(document.getElementById('transactionId').value),
                    BatchId: parseInt(document.getElementById('batchId').value),
                    AccountId: parseInt(document.getElementById('accountId').value),
                    SubscriptionId: 1, // Dummy value
                    CustomerId: parseInt(document.getElementById('customerId').value),
                    CurrencyCode: document.getElementById('currencyCode').value,
                    CountryCode: document.getElementById('countryCode').value,
                    ProductId: parseInt(document.getElementById('productId').value),
                    ChannelId: parseInt(document.getElementById('channelId').value),
                    TransactionStartTime: new Date(document.getElementById('transactionStartTime').value).toISOString(),
                    Amount: parseFloat(document.getElementById('amount').value)
                };
            } else {
                formData = {
                    TransactionId: 1, // Dummy value
                    BatchId: 1,      // Dummy value
                    AccountId: 1,    // Dummy value
                    SubscriptionId: 1,// Dummy value
                    CustomerId: 256, // Dummy value
                    CurrencyCode: 'UGX',
                    CountryCode: '256',
                    ProductId: 0,     // Dummy value
                    ChannelId: 2,    // Dummy value
                    TransactionStartTime: new Date(document.getElementById('lastTransactionDate').value).toISOString(),
                    Amount: parseFloat(document.getElementById('avgTransactionAmount').value)
                };
            }

            try {
                document.getElementById('loading').classList.remove('hidden');
                document.querySelector('.assessment-card').classList.add('blur-sm');

                const response = await fetch('http://localhost:8000/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) throw new Error('Server error');
                
                const data = await response.json();
                
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('creditScore').textContent = data.credit_score;
                document.getElementById('statusIndicator').style.backgroundColor = 
                    data.credit_score >= 600 ? '#10b981' : '#ef4444';
                document.getElementById('riskStatus').textContent = 
                    data.credit_score >= 600 ? 'Low Risk' : 'High Risk';
                document.getElementById('recommendation').textContent = 
                    data.credit_score >= 600 ? 'Recommend Approval' : 'Further Verification Required';

            } catch (error) {
                alert('Analysis failed: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.querySelector('.assessment-card').classList.remove('blur-sm');
            }
        }

        document.getElementById('detailedForm').addEventListener('submit', handleSubmit);
        document.getElementById('simpleForm').addEventListener('submit', handleSubmit);
    </script>
</body>
</html>